---
title: "An exploratory analysis of mosquito abundance and species composition by trap height and blend type"
date: "2026-02-20"
output: html_document
---
Below is my exploratory data analysis. The script was developed in `edacode.R` first and pulled into this Quarto file. Unlike `edacode.R`, this file includes actual thought processes regarding the figures and tables created. Figures are not saved in this file, but they are in `edacode.R`. The code in this file is not meant to be run as is, but rather to show how one might write up an EDA process, though it could run if you so chose to.

# Setup

Load necessary packages. 
```{r}
#load needed packages. make sure they are installed.
library(here) 
library(dplyr)
library(skimr)
library(ggplot2)
library(gt)
library(tidyr)
library(knitr)
```

Load in the cleaned data.
```{r}
# Load cleaned data
blend1 <- readRDS(here::here("data","processed-data","blend1.rds"))
species1 <- readRDS(here::here("data","processed-data","species1.rds"))
identification1 <- readRDS(here::here("data","processed-data","identification1.rds"))
height1 <- readRDS(here::here("data","processed-data","height1.rds")) 
```
```{r}
# Take a look at the data and structure.
head(blend1)
head(species1)
str(identification1)
str(height1)
```

# Data exploration through tables

```{r}
# file paths
abt_rds <- here::here("results", "tables", "abundance-height-table.rds")
pah_rds <- here::here("results", "tables", "pooled-abundance-height.rds")

# load rds tables
abundance_height_table <- readRDS(abt_rds)
pooled_abundance_height <- readRDS(pah_rds)

abundance_height_table # this table shows total mosquito abundance by height/date.
pooled_abundance_height # this table shows total pooled counts across all trap events.
```

Here, I have two tables that summarize mosquito abundance by height. The first one shows the abundance by height and date, while the second one pools all data together to show total abundance. I have two few trapping events to calculate meaningful means here, so totals will have to do for now. 

While we see marginally more mosquitoes in the canopy compared to midlevel, this difference does not appear to be statistically significant.

# Data exploration through figures

Histogram plots for the continuous outcomes. 

Height first.

```{r}
# paths to figures
# file paths (in requested order)
fig_abundance <- here::here("results","figures","eda-figures","abundance-height-boxplot.png")
fig_pooled    <- here::here("results","figures","eda-figures","pooled-abundance-height.png")
fig_topsp     <- here::here("results","figures","eda-figures","top-species-blend.png")
lm_rds        <- here::here("results","figures","eda-figures","lm-logRR-blend-all.rds")
fig_fit_all   <- here::here("results","figures","eda-figures","fit-species-blend-all.png")
```

```{r}
abundance_height_boxplot <- here::here("results","figures","eda-figures","abundance-height-boxplot.png")

file.exists(abundance_height_boxplot)   # should be TRUE
knitr::include_graphics(abundance_height_boxplot)
```

```{r}
#There appeared to be some sort of issue with figure images not loading. This section done again by chatgpt5.2
dir.create("eda-assets", showWarnings = FALSE)

file.copy(
  here::here("results","figures","eda-figures","abundance-height-boxplot.png"),
  "eda-assets/abundance-height-boxplot.png",
  overwrite = TRUE
)

file.copy(
  here::here("results","figures","eda-figures","pooled-abundance-height.png"),
  "eda-assets/pooled-abundance-height.png",
  overwrite = TRUE
)

file.copy(
  here::here("results","figures","eda-figures","top-species-blend.png"),
  "eda-assets/top-species-blend.png",
  overwrite = TRUE
)

file.copy(
  here::here("results","figures","eda-figures","fit-species-blend-all.png"),
  "eda-assets/fit-species-blend-all.png",
  overwrite = TRUE
)
```

```{r}
knitr::include_graphics("eda-assets/abundance-height-boxplot.png")
```

For the `height1` dataset, I created a boxplot to visualize the distribution of mosquito abundance by height. Higher trap height is denoted by `canopy (10ft)` and lower trap height is denoted by `midlevel (4â€“6ft)`. The boxplot shows that there is some variability in mosquitoes per trap-night, but it doesn't appear to be significant. Then again, there are <5 trap nights, so we can't really draw conclusions from this figure.

```{r}
knitr::include_graphics("eda-assets/top-species-blend.png")
```

Here I wanted to see which mosquito species were most abundant across all trapping events. As a reminder, traps were set up in treatment and control pairs. It's pretty clear than Uranotaenia sapphirinia is the most abundant species regardless of blend type, with strong preference for `blend_a` over control when compared to `blend_b` vs control.

It also appears that many of the most abundant species are more abundant in `blend_a` than `blend_b` proportionally. What strikes me as odd is that for `blend_b`, the most abundant species seem to favor treatment, but the trend appears to reverse as mean mosquitoes per trap pair decreases. This is something to look into further, but it could be due to the fact that there are fewer mosquitoes in `blend_b` overall, so the most abundant species are more likely to be found in treatment traps by chance. Either way, I was surprised at how much of a difference there was in species abundance between the two blends, and I want to explore this further with some modeling. 

Ur. sapphirinia is my most abundant species, but I cannot express how intriguing this is! I hope to dive more into this species, via literature and this analysis, as we continue. If you get the chance-- look up a picture of them. Very aesthetically pleasing.

```{r}
knitr::include_graphics("eda-assets/fit-species-blend-all.png")
```

This is my biggest lm fit to date. I wanted to see how the log response ratio (logRR) of treatment vs control varied across species and blend type. I included all species in this figure, though top 10 may have been enough.

To explain, the logRR is calculated as log(treatment+0.5/control+0.5) to avoid log(0) issues since there are bound to be zero-values in my data as not every species will be found in every trap at every event, and the zeros are too meaningful to clean out. Each panel is 1 species, with each grey dot is 1 trap pair for species. A logRR of 0 means no effect, >0 means blend caught more, <0 means given blend caught fewer. The blue line indicates which blend type elicits a stronger response for each species. For example, if the blue line is above 0, that means `blend_a` caught more of that species than control on average, and if it's below 0, that means `blend_b` caught more of that species than control on average.

This graph is simply too massive, so I will need to break this down into smaller pieces. I think my next step should be to create separate figures for each blend type, and then maybe even separate figures for the top 10 most abundant species so it's easier on the eyes. However, I think this model fit is a good starting point to see how species respond to blends, and can be further extracted to look at specific species of interest, such as ornithophilic mosquitoes and more specifically, mosquitoes implicated or suspected to be involved in arbovirus transmission in association with birds (e.g., Culex spp, Cs. melanura, An. crucians comp, etc...)

# Notes
AI Disclaimer: Chatgpt5.2 was used to help load in and double check figures and for code for the plots. All words and interpretations are my own. 
